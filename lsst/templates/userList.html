{% extends "_base_lsst.html" %}
{% load url from future %}

{% block page_title %} {{ viewParams.MON_VO }} PanDA users{% endblock %}
{% block title %} <a href="/lsst/">{{ viewParams.MON_VO }} PanDA monitor</a>{% endblock %}
{% block subtitle %}PanDA active user list{{viewParams.selection }}
{% if vo %} &nbsp; for VO {{ vo }}{% endif %}
{% endblock %}
{% block body %}

{% if sumd %}
{% comment %}
The dynamic summary table used presently for non-ATLAS.
{% endcomment %}

<table>
{% for fdict in jobsumd %}
<tr><th> {{ fdict.field }} </th><td>
{% for item in fdict.list %}
{% if fdict.field == 'jobstatus' %} <span class='{{item.kname}}'> {% else %} <span> {% endif %}  {{ item.kname }} </span>
<a href="{{xurl}}{{fdict.field}}={{item.kname}}">({{ item.kvalue }})</a> &nbsp; 
{% endfor %}
</td></tr>
{% endfor %}
</table>

<table>
<tr>
<th> User </th>
<th> nJobs </th>
<th> nFinished </th>
<th> nFailed </th>
<th> nHolding </th>
<th> nCancelled </th>
<th> nQueued </th>
<th> nSites </th>
<th> nClouds </th>
<th> CPU</th>
</tr>

{% for userd in sumd %}
<tr>
<th> <a href="/lsst/user/{{userd.dict.name}}">{{userd.dict.name}}</a> </th>
<td> {{ userd.dict.njobs }} </td>
<td class='finished'> {{ userd.dict.nfinished }} </td>
<td class='failed'> {{ userd.dict.nfailed }} </td>
<td class='holding'> {{ userd.dict.nholding }} </td>
<td class='cancelled'> {{ userd.dict.ncancelled }} </td>
<td class='defined'> {{ userd.dict.nqueued }} </td>
<td> {{ userd.dict.nsites }} </td>
<td> {{ userd.dict.nclouds }} </td>
<td> {{ userd.dict.cputime }} </td>
</tr>
{% endfor %}
</table>

{% endif %}

{% if userdb %}
{% comment %}
The user DB presently generated only for ATLAS.
{% endcomment %}

<table>
<tr>
<th> <a href="{{url}}?sortby=name">User</a> </th>
<th> <a href="{{url}}?sortby=njobs">nJobs</a> </th>
<th> <a href="{{url}}?sortby=date">Latest</a> </th>
<th> <a href="{{url}}?sortby=cpua1">Personal CPU-hrs<br>1 day</a> </th>
<th> <a href="{{url}}?sortby=cpua7">Personal CPU-hrs<br>7 days</a> </th>
<th> <a href="{{url}}?sortby=cpup1">Group CPU-hrs<br>1 day</a> </th>
<th> <a href="{{url}}?sortby=cpup7">Group CPU-hrs<br>7 days</a> </th>
</tr>

{% for user in userdb %}
<tr>
<th> <a href="/lsst/user/{{user.name}}">{{user.name}}</a> </th>
<td> {{ user.njobsa }} </td>
<td>{{ user.latestjob|date:"Y-m-d H:i" }}</td>

{% comment %}
<td class='finished'> {{ user.nfinished }} </td>
<td class='failed'> {{ user.nfailed }} </td>
<td class='holding'> {{ user.nholding }} </td>
<td class='cancelled'> {{ user.ncancelled }} </td>
<td class='defined'> {{ user.nqueued }} </td>
{% endcomment %}
<td> {{ user.cpua1 }} </td>
<td> {{ user.cpua7 }} </td>
<td> {{ user.cpup1 }} </td>
<td> {{ user.cpup7 }} </td>
</tr>
{% endfor %}
</table>

{% endif %}

{% endblock %}

{% block bottom_info %}
{% endblock %}

{% block left_menu %}
{% comment %}
<div class="left-menu">
  {% block left_menu_content %}
    <span class="left-menu-title">Menu</span>
     <br> <a class="left-menu-item" href="{{ prefix }}/#">Home</a>
  {% endblock %}
</div>
{% endcomment %}
{% endblock %}
