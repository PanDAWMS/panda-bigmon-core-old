{% extends "_base_lsst.html" %}
{% load url from future %}

{% block page_title %} {{ viewParams.MON_VO }} PanDA jobs{% endblock %}
{% block title %} <a href="{% url 'index' %}">{{ viewParams.MON_VO }} PanDA monitor</a>{% endblock %}
{% block subtitle %}PanDA {{view}} dashboard{{ viewParams.selection }}
{% endblock %}
{% block body %}

{{ viewParams.header }}

{% if viewParams.MON_VO != 'ATLAS' %}

<table width=800><tr><td>
This page summarizes recent job status for VOs, clouds and sites. Click on the numbers to see job listings.
Failure rates above {{ errthreshold }}% are shown in red.
Click the cloud name in the overall summary to go to the cloud's site summary.
Click the job counts to go to job listings.
</tr></td></table>
<p>

<div class='section'>VO / Cloud / Site summary</div>
{% else %}

{% if view == 'analysis' %}
<div class='section'>Analysis jobs</div>
{% elif view == 'production' %}
<div class='section'>Production jobs</div>
{% else %}
<div class='section'>All jobs</div>
{% endif %}

{% if view != 'analysis' %}

{% if cloudview == 'region' %}

<table width=800><tr><td>
<b>Region view</b><br>
This view associates jobs with clouds on the basis of the region in which the processing site is located.
The alternative <a href="{% url 'dashProduction' %}">'cloud' view</a> associates jobs with clouds on the basis of which Tier 1 the job is assigned to (which can be different for a site participating in multi-cloud production).
Failure rates above {{ errthreshold }}% are shown in red.
Click the cloud name in the overall summary to go to the cloud's site summary.
Click the job counts to go to job listings.
</tr></td></table>
<p>

{% else %}

<table width=800><tr><td>
<b>Cloud view</b><br>
This view associates jobs with clouds on the basis of which Tier 1 the job is assigned to, which can be different from the 'home cloud' of the processing site for a site participating in multi-cloud production (MCP). Thus in this view you may see sites listed in the CA cloud which are not located in CA.
The alternative <a href="{% url 'dashProduction' %}?cloudview=region">'region' view</a> associates production jobs with clouds on the basis of the region in which the processing site is located.
Failure rates above {{ errthreshold }}% are shown in red.
Click the cloud name in the overall summary to go to the cloud's site summary.
Click the job counts to go to job listings.
</tr></td></table>
<p>
{% endif %}

{% else %}

<table width=800><tr><td>
Failure rates above {{ errthreshold }}% are shown in red.
Click the cloud name in the overall summary to go to the cloud's site summary.
Click the job counts to go to job listings.
</tr></td></table>
<p>

{% endif %}

<div class='section'>Cloud / Site summary</div>
{% endif %}

<table>

{% if viewParams.MON_VO != 'ATLAS' %}

<tr bgcolor="lightcyan">
<th> VO </th>
<th>  </th>
<th> nJobs </th>
<th> % failed </th>
<th> assigned </th>
<th> throttled </th>
<th> activated </th>
<th> sent </th>
<th> starting </th>
<th> running </th>
<th> holding </th>
<th> transferring </th>
<th> finished </th>
<th> failed </th>
<th> cancelled </th>
</tr>

{% for vo in vosummary %}
<tr height=10 colspan=12></tr>
<tr>
<th  bgcolor=whitesmoke> {{ vo.name }} </th>
<th> </th>
<th  bgcolor=whitesmoke align='right'> <a href="{% url 'jobList' %}?vo={{ vo.name }}&hours={{hours}}&jobtype={{ view }}&display_limit=100">{{ vo.count }}</a> </th>
<th  bgcolor=whitesmoke align='right'>{{ vo.pctfail|safe  }} </th>
{% for state in vo.statelist %}
<th  bgcolor=whitesmoke align='right'> <a href="{% url 'jobList' %}?vo={{ vo.name }}&jobstatus={{ state.name }}&hours={{hours}}&jobtype={{ view }}&display_limit=100"> <span class="{{ state.name }}">{{ state.count }}</span></a> </th>
{% endfor %}
</tr>
{% endfor %}
<tr height=10 colspan=12></tr>

{% endif %}


<tr bgcolor="lightcyan">
<th> Cloud </th>
<th> Status</th>
<th> nJobs </th>
<th> % failed </th>
<th> assigned </th>
<th> throttled </th>
<th> activated </th>
<th> sent </th>
<th> starting </th>
<th> running </th>
<th> holding </th>
<th> transferring </th>
<th> finished </th>
<th> failed </th>
<th> cancelled </th>
</tr>

{% for cloud in summary %}
<tr height=10 colspan=12></tr>
<tr>
<th  bgcolor=whitesmoke> {% if cloud.name != 'All' %}{% if cloud.name != '' %}<a href="#cloud_{{ cloud.name }}"><span class="{{cloud.status}}">{{ cloud.name }}</span></a>{% else %} Failed before site assigned {% endif %} {% else %}  All clouds {% endif %}</th>
<th  bgcolor=whitesmoke> <span class="{{cloud.status}}">{{ cloud.status }}</span> </th>
<th  bgcolor=whitesmoke align='right'><a href="{% url 'jobList' %}?cloud={{ cloud.name }}&hours={{hours}}&jobtype={{ view }}&display_limit=100"> {{ cloud.count }} </a></td>
<th  bgcolor=whitesmoke align='right'>{{ cloud.pctfail|safe  }} </th>
{% for state in cloud.statelist %}
<th  bgcolor=whitesmoke align='right'><a href="{% url 'jobList' %}?cloud={{ cloud.name }}&jobstatus={{ state.name }}&hours={{hours}}&jobtype={{ view }}&display_limit=100"> <span class="{{ state.name }}"> {{ state.count }}</span></a> </td>
{% endfor %}
</tr>
{% endfor %}


{% for cloud in summary %}

{% if cloud.name != 'All' %}

<tr height=10 colspan=12></tr>
<tr>
<td class="tablesection"> <a name="cloud_{{ cloud.name }}"><span class="{{cloud.status}}">{{ cloud.name }} Cloud</span></a>, Sites </td>
<td class="tablesection"> Status</td>
<td class="tablesection"> nJobs </td>
<td class="tablesection"> % failed </td>
<td class="tablesection"> assigned </td>
<td class="tablesection"> throttled </td>
<td class="tablesection"> activated </td>
<td class="tablesection"> sent </td>
<td class="tablesection"> starting </td>
<td class="tablesection"> running </td>
<td class="tablesection"> holding </td>
<td class="tablesection"> transferring </td>
<td class="tablesection"> finished </td>
<td class="tablesection"> failed </td>
<td class="tablesection"> cancelled </td>
</tr>

<tr height=10 colspan=12></tr>
<tr>
<th bgcolor=whitesmoke> {{ cloud.name }} all sites {% if cloudview != 'region' and view != 'analysis' %} including MCP {% endif %}</th>
<th bgcolor=whitesmoke> </th>
<th bgcolor=whitesmoke align='right'> <a href="{% url 'jobList' %}?cloud={{ cloud.name }}&hours={{hours}}&jobtype={{ view }}&display_limit=100">{{ cloud.count }}</a> </th>
<th  bgcolor=whitesmoke align='right'>{{ cloud.pctfail|safe  }} </th>
{% for state in cloud.statelist %}
<th bgcolor=whitesmoke align='right'> <a href="{% url 'jobList' %}?cloud={{ cloud.name }}&jobstatus={{ state.name }}&hours={{hours}}&jobtype={{ view }}&display_limit=100"><span class="{{ state.name }}">{{ state.count }}</span></a> </th>
{% endfor %}
</tr>
{% for site in cloud.summary %}
<tr>
<td> {% if site.name %} <span class="{{ site.status }}">{{ site.name }}</span> {% else %} Failed before site assignment {% endif %} </td>
<td><span class="{{site.status}}">{{ site.status  }}</span> </td>
<td align='right'><a href="{% url 'jobList' %}?computingsite={{ site.name }}&hours={{hours}}&jobtype={{ view }}&display_limit=100"> {{ site.count }} </a></td>
<td>{{ site.pctfail|safe  }} </td>
{% for state in site.summary %}
<td class='{{state.name}}' align='right'><a href="{% url 'jobList' %}?computingsite={{ site.name }}&jobstatus={{ state.name }}&hours={{hours}}&jobtype={{ view }}&display_limit=100"> <span class="{{ state.name }}"> {{ state.count }} </span></a> </td>
{% endfor %}
</tr>
{% endfor %}

{% endif %}

{% endfor %}
</table>

{% endblock %}

{% block bottom_info %}
{% endblock %}

{% block left_menu %}
{% comment %}
<div class="left-menu">
  {% block left_menu_content %}
    <span class="left-menu-title">Menu</span>
     <br> <a class="left-menu-item" href="{{ prefix }}/#">Home</a>
  {% endblock %}
</div>
{% endcomment %}
{% endblock %}
